# 5. GÃ¼n: Repository KatmanÄ± â€“ @Repository, Spring Data JPA ile VeritabanÄ± EriÅŸimi

```
Hedefler:

@Repository anotasyonunu Ã¶ÄŸrenmek
Spring Data JPA ile CRUD iÅŸlemlerinin nasÄ±l kolaylaÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nÄ± anlamak
Entity ve Repository kavramlarÄ±nÄ± tanÄ±mak
Ä°lk veritabanÄ± tablosunu oluÅŸturmak
```

## ğŸ” 1. Repository Nedir?

`Repository`, veri eriÅŸim katmanÄ±dÄ±r. Yani veritabanÄ± iÅŸlemlerini (CRUD: create, read, update, delete) gerÃ§ekleÅŸtirir.

`â€œService mantÄ±ÄŸÄ± veriyi yÃ¶netir, Repository veriye ulaÅŸÄ±r.â€`

## ğŸ§© 2. @Repository Anotasyonu Ne Yapar?

1. Bir sÄ±nÄ±fÄ± Spring'e __"veri eriÅŸim bileÅŸeni"__ olarak tanÄ±tÄ±r.

2. Exception handlingâ€™i otomatik yapar (@Repository ile sarmalanan hatalar, Spring tarafÄ±ndan DataAccessException'a dÃ¶nÃ¼ÅŸtÃ¼rÃ¼lÃ¼r).

3. Spring Data JPA ile birlikte __@Repository__ anotasyonu arayÃ¼z seviyesinde bile gerekmez (ama anlaÅŸÄ±lÄ±r kÄ±lar).


## ğŸ“ 3. Entity OluÅŸturma

`ğŸ“„ Post.java (Ã¶rnek bir blog post entity'si):`

```Java
package com.blog.blogapi.entity;

import jakarta.persistence.*;

@Entity
@Table(name = "posts")
public class Post {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String title;
    private String content;

    // Getter ve Setter metodlarÄ±
}
```

ğŸ” __AÃ§Ä±klamalar:__

1. `@Entity:` SÄ±nÄ±fÄ± veritabanÄ± tablosuna dÃ¶nÃ¼ÅŸtÃ¼rÃ¼r.
2. `@Table:` Tablonun adÄ±nÄ± belirtir. (isteÄŸe baÄŸlÄ±)
3. `@Id:` Primary key tanÄ±mÄ±.
4. `@GeneratedValue:` Otomatik ID Ã¼retimi (auto increment gibi).

## ğŸ§ª 4. Repository Interfaceâ€™i YazalÄ±m

`ğŸ“„ PostRepository.java:`

```Java
package com.blog.blogapi.repository;

import com.blog.blogapi.entity.Post;
import org.springframework.data.jpa.repository.JpaRepository;

public interface PostRepository extends JpaRepository<Post, Long> {
    // CRUD iÅŸlemleri hazÄ±r geliyor
}
```

âœ… __JpaRepository Ne SaÄŸlar?__

| Metot            | AÃ§Ä±klama                   |
| ---------------- | -------------------------- |
| `findAll()`      | TÃ¼m kayÄ±tlarÄ± getirir      |
| `findById(id)`   | IDâ€™ye gÃ¶re getirir         |
| `save(entity)`   | KayÄ±t ekler veya gÃ¼nceller |
| `deleteById(id)` | Silme iÅŸlemi yapar         |


ğŸ“‚ GÃ¼ncellenmiÅŸ Proje YapÄ±sÄ±:

```
com.blog.blogapi
â”œâ”€â”€ controller
â”œâ”€â”€ service
â”œâ”€â”€ repository
â”‚   â””â”€â”€ PostRepository.java
â”œâ”€â”€ entity
â”‚   â””â”€â”€ Post.java
```

## âš™ï¸ VeritabanÄ± YapÄ±landÄ±rmasÄ± (application.properties)

```properties
spring.datasource.url=jdbc:postgresql://localhost:5432/blogdb
spring.datasource.username=postgres
spring.datasource.password=123456
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
```

`Not: VeritabanÄ±nÄ± Ã§alÄ±ÅŸtÄ±rmayÄ± unutma. PostgreSQL kullanÄ±yorsan blogdb adÄ±nda bir veritabanÄ± oluÅŸturulmuÅŸ olmalÄ±`

## â—ï¸ Sorunlar ve Ã‡Ã¶zÃ¼mleri

| Problem                         | Ã‡Ã¶zÃ¼m                                                   |
| ------------------------------- | ------------------------------------------------------- |
| `Unable to connect to database` | URL, kullanÄ±cÄ± adÄ± veya ÅŸifre yanlÄ±ÅŸ                    |
| `EntityNotFoundException`       | `@Entity` unutulmuÅŸ olabilir                            |
| `Table does not exist`          | `ddl-auto=none` ise tabloyu elle oluÅŸturmak gerekebilir |



