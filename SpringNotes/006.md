# ğŸ”„ 6. GÃ¼n: DTO (Data Transfer Object) ve Mapper KatmanÄ±

```
ğŸ¯ Hedefler:

DTO nedir, neden kullanÄ±lÄ±r?

Entity â†” DTO dÃ¶nÃ¼ÅŸÃ¼mleri nasÄ±l yapÄ±lÄ±r?

MapStruct gibi otomatik dÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼ kÃ¼tÃ¼phaneler nasÄ±l entegre edilir?
```

## ğŸ“Œ 1. DTO Nedir?

__DTO (Data Transfer Object)__, veri katmanlarÄ± arasÄ±nda veri taÅŸÄ±mak iÃ§in kullanÄ±lan sade objelerdir.
Direkt olarak Entity gÃ¶ndermek gÃ¼venli deÄŸildir. 

### ğŸš¨ Neden Entity Kullanmak Tehlikeli?

| Sorun                | AÃ§Ä±klama                                                                     |
| -------------------- | ---------------------------------------------------------------------------- |
| GÃ¼venlik             | Entity tÃ¼m veritabanÄ± kolonlarÄ±nÄ± taÅŸÄ±r. KullanÄ±cÄ±ya gizli alanlar da gider. |
| DeÄŸiÅŸim Riski        | Entity deÄŸiÅŸirse, tÃ¼m endpointâ€™ler etkilenir.                                |
| Validasyon KarmaÅŸasÄ± | DTO ile `@NotBlank`, `@Size`, vs. kullanÄ±mÄ± daha temiz olur.                 |
| Performans           | Lazy loading iliÅŸkilerde sÄ±kÄ±ntÄ± Ã§Ä±karabilir.                                |

## ğŸ§± 2. DTO NasÄ±l OluÅŸturulur?

`ğŸ“„ PostDto.java:`

```Java
package com.blog.blogapi.dto;

public class PostDto {
    private Long id;
    private String title;
    private String content;

    // Getter â€“ Setter
}
```

## ğŸ” 3. Entity â†” DTO DÃ¶nÃ¼ÅŸÃ¼mÃ¼ (Manuel)

`ğŸ“„ PostService.java` 

```Java
public PostDto mapToDto(Post post) {
    PostDto dto = new PostDto();
    dto.setId(post.getId());
    dto.setTitle(post.getTitle());
    dto.setContent(post.getContent());
    return dto;
}

/* 
ğŸ” AÃ§Ä±klama:
mapToDto: VeritabanÄ±ndan gelen Post entity nesnesini alÄ±r.

Yeni bir PostDto nesnesi oluÅŸturur.

AlanlarÄ± birebir kopyalar (ama sadece id, title, content).

BÃ¶ylece entityâ€™yi dÄ±ÅŸ dÃ¼nyaya doÄŸrudan aÃ§madan veri taÅŸÄ±mÄ±ÅŸ oluruz.
*/

public Post mapToEntity(PostDto dto) {
    Post post = new Post();
    post.setId(dto.getId());
    post.setTitle(dto.getTitle());
    post.setContent(dto.getContent());
    return post;
}

/*
ğŸ” AÃ§Ä±klama:
mapToEntity: Ä°stemciden gelen PostDtoâ€™yu alÄ±r.

Post entity nesnesine dÃ¶nÃ¼ÅŸtÃ¼rÃ¼r.

Bu nesne veritabanÄ±na kaydedilebilir hÃ¢le gelir.
*/
```

## âš¡ 4. MapStruct ile Otomatik Mapping (Opsiyonel - Ä°leri Seviye)

`ğŸ“¦ pom.xml ekle:`

```xml
<dependency>
    <groupId>org.mapstruct</groupId>
    <artifactId>mapstruct</artifactId>
    <version>1.5.5.Final</version>
</dependency>
<dependency>
    <groupId>org.mapstruct</groupId>
    <artifactId>mapstruct-processor</artifactId>
    <version>1.5.5.Final</version>
    <scope>provided</scope>
</dependency>
```

`ğŸ“„ PostMapper.java:`

```Java
@Mapper(componentModel = "spring")
public interface PostMapper {
    PostDto toDto(Post post);
    Post toEntity(PostDto postDto);
}
```

DÃ¶nÃ¼ÅŸtÃ¼rme iÅŸlemleri otomatik olur, kodun %70â€™i temizlenir.

## ğŸ§ª 5. Service KatmanÄ±nda KullanÄ±mÄ±

```Java
@Service
public class PostService {

    private final PostRepository postRepository;

    public PostService(PostRepository postRepository) {
        this.postRepository = postRepository;
    }

    public List<PostDto> getAllPosts() {
        List<Post> posts = postRepository.findAll();
        return posts.stream()
                    .map(this::mapToDto)
                    .collect(Collectors.toList());
    }
}
```

ğŸ” __AÃ§Ä±klama:__

- `findAll()` metodu tÃ¼m Post entity nesnelerini getirir.
- `map(this::mapToDto)` ile her birini `PostDtoâ€™ya Ã§eviririz.
- `collect(...)` ile liste haline getiririz.
- BÃ¶ylece dÄ±ÅŸ dÃ¼nyaya sadece DTO dÃ¶ndÃ¼rÃ¼lmÃ¼ÅŸ olur.

## ğŸ§© 6. Controllerâ€™da DTO KullanÄ±mÄ±

```Java
@RestController
@RequestMapping("/api/posts")
public class PostController {

    private final PostService postService;

    public PostController(PostService postService) {
        this.postService = postService;
    }

    @GetMapping 
    public ResponseEntity<List<PostDto>> getAllPosts() {
        return ResponseEntity.ok(postService.getAllPosts());
    }
}
```

ğŸ” __AÃ§Ä±klama:__

- `/api/posts` endpointâ€™ine gelen GET isteÄŸi, tÃ¼m post'larÄ± dÃ¶ner.
- Ama Post deÄŸil, PostDto dÃ¶ndÃ¼rÃ¼lÃ¼r.
- Bu sayede sadece ihtiyacÄ±mÄ±z olan veriler clientâ€™a gider.